[ { "title": "Inconsistent DateTime arithmetic", "url": "/posts/inconsistent-datatime-arithmetic/", "categories": "PHP, Datetime", "tags": "php, datetime", "date": "2021-11-22 21:00:00 +0100", "snippet": "There is some inconsistency in date/time operations. Example presented in this post is written in PHP language, but it also exists in Java, C# and probably more languages.This post was inspired by book Software Mistakes and Tradeoffs by Tomasz Lelek and Jon Skeet.RequirementsLet’s assume you’re building a voting app. The requirement is to check if voter is 18 years old.SolutionYou can do it in two ways by:* Subtracting 18 years from election date Adding 18 years to voter’s birthday*there are more combinations, but these use cases covers themImplementationFor the blog post purposes we’ll see tests which covers these cases.Implementation of subtractingpublic function test_can_person_vote_by_subtracting_18_years_from_election_date(): void{ //Given $electionDate = DateTimeImmutable::createFromFormat(&#39;Y-m-d&#39;, &#39;2022-02-28&#39;); $personBirthDay = DateTimeImmutable::createFromFormat(&#39;Y-m-d&#39;, &#39;2004-02-29&#39;); $eighteenYearsInterval = new DateInterval(&#39;P18Y&#39;); //When $result = $electionDate-&amp;gt;sub($eighteenYearsInterval); //Then self::assertTrue($personBirthDay &amp;gt;= $result);}Test result is positive - it passes. It means that person can vote in this case. To visualize it better I prepared a picture with timeline showing this case.Implementation of addingpublic function test_can_person_vote_by_adding_18_years_to_birthday(): void{ //Given $electionDate = DateTimeImmutable::createFromFormat(&#39;Y-m-d&#39;, &#39;2022-02-28&#39;); $personBirthDay = DateTimeImmutable::createFromFormat(&#39;Y-m-d&#39;, &#39;2004-02-29&#39;); $eighteenYearsInterval = new DateInterval(&#39;P18Y&#39;); //When $result = $personBirthDay-&amp;gt;add($eighteenYearsInterval); //Then self::assertTrue($electionDate &amp;gt;= $result);}This time test is red - it fails which means person cannot vote because will have 18 birthdays on 2022-03-01 and the election date is 2022-02-28.SummaryYou need to be careful when you work with dates, because many traps you can be caught. In this particular case I would suggest asking your business, because answer depends on country you are building software for." } ]
